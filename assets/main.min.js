const CONFIG={affiliateLink:"https://try.elevenlabs.io/q4qifzaxhkwg",gaTrackingId:"G-952B25HTV8",newsletterEndpoint:"https://script.google.com/macros/s/your-apps-script-url/exec",consentDuration:365,utmStorageDuration:90},STATE={consent:{necessary:!0,analytics:!1,timestamp:null},currentLanguage:document.documentElement.lang,isNavOpen:!1};function initApplication(){console.log("Initialisation de l'application...");try{initNavigation(),initFAQAccordions(),initYouTubeLite(),initNewsletterForm(),initConsentManagement(),checkLanguageSuggestion(),initScrollAnimations(),initHeroVideoLazyLoad(),console.log("Application initialisée avec succès")}catch(e){console.error("Erreur lors de l'initialisation:",e)}}function initNavigation(){const e=document.querySelector(".nav-toggle"),t=document.querySelector(".nav-menu");e&&t?(e.addEventListener("click",function(){toggleNavigation()}),document.addEventListener("click",function(n){!STATE.isNavOpen||e.contains(n.target)||t.contains(n.target)||toggleNavigation(!1)}),document.addEventListener("keydown",function(e){STATE.isNavOpen&&"Escape"===e.key&&toggleNavigation(!1)})):console.warn("Éléments de navigation non trouvés")}function toggleNavigation(e){const t=document.querySelector(".nav-toggle"),n=document.querySelector(".nav-menu");t&&n&&(STATE.isNavOpen=void 0!==e?e:!STATE.isNavOpen,t.setAttribute("aria-expanded",STATE.isNavOpen),n.setAttribute("aria-expanded",STATE.isNavOpen),STATE.isNavOpen?n.style.transform="translateX(0)":n.style.transform="translateX(-100%)")}function ensureAnalyticsStub(){window.dataLayer||(window.dataLayer=[]),window.gtag||(window.gtag=function(){dataLayer.push(arguments)})}function initHeroVideoLazyLoad(){const e=document.querySelector(".hero-video");if(!e)return;const t=navigator.connection||navigator.mozConnection||navigator.webkitConnection,n=window.matchMedia("(prefers-reduced-motion: reduce)").matches,o=Boolean(t&&t.saveData),a=t&&["slow-2g","2g","3g"].includes(t.effectiveType),i=window.matchMedia("(max-width: 768px)").matches;if(n||o||a||i)return void e.removeAttribute("autoplay");const r=()=>{if(e.dataset.loaded)return;const t=e.querySelector("source"),n=t&&t.dataset.src||e.dataset.src;n&&(t?(t.src=n,t.removeAttribute("data-src")):e.src=n,e.dataset.loaded="true",e.muted=!0,e.load(),e.play().catch(()=>{}))};"requestIdleCallback"in window?requestIdleCallback(()=>r(),{timeout:1500}):setTimeout(r,1200)}function setDefaultConsentMode(){window.__gaDefaultConsentSet||(window.__gaDefaultConsentSet=!0,ensureAnalyticsStub(),gtag("consent","default",{ad_storage:"denied",analytics_storage:"denied",functionality_storage:"granted",security_storage:"granted"}))}function initConsentManagement(){setDefaultConsentMode();const e=document.getElementById("cookie-consent");if(!e)return;const t=getStorageItem("cookie_consent");t?(STATE.consent=t,updateConsentState()):e.hidden=!1;const n=document.getElementById("cookie-accept"),o=document.getElementById("cookie-necessary");n&&n.addEventListener("click",function(){setConsent(!0,!0)}),o&&o.addEventListener("click",function(){setConsent(!0,!1)})}function setConsent(e,t){STATE.consent={necessary:e,analytics:t,timestamp:(new Date).toISOString()},setStorageItem("cookie_consent",STATE.consent,CONFIG.consentDuration),updateConsentState();const n=document.getElementById("cookie-consent");n&&(n.hidden=!0)}function updateConsentState(){STATE.consent.analytics&&loadGoogleAnalytics()}function loadGoogleAnalytics(){if(window.__gaConsentGranted)return;window.__gaConsentGranted=!0,ensureAnalyticsStub();if(!document.querySelector('script[src*="googletagmanager.com/gtag/js"]')){const e=document.createElement("script");e.async=!0,e.src=`https://www.googletagmanager.com/gtag/js?id=${CONFIG.gaTrackingId}`,e.dataset.source="consent-loader",document.head.appendChild(e)}gtag("js",new Date),gtag("consent","update",{analytics_storage:"granted",ad_storage:"denied",functionality_storage:"granted",security_storage:"granted"}),gtag("config",CONFIG.gaTrackingId,{anonymize_ip:!0}),console.log("GA4 injecté dynamiquement et activé.")}function initFAQAccordions(){const e=document.querySelectorAll(".faq-item");e.forEach(t=>{const n=t.querySelector(".faq-question"),o=t.querySelector(".faq-answer");n&&o&&n.addEventListener("click",function(){const a="true"===n.getAttribute("aria-expanded");a||e.forEach(e=>{if(e!==t){const t=e.querySelector(".faq-question"),n=e.querySelector(".faq-answer");t.setAttribute("aria-expanded","false"),n.style.display="none"}}),n.setAttribute("aria-expanded",!a),o.style.display=a?"none":"block"})})}function initYouTubeLite(){document.querySelectorAll(".youtube-lite").forEach(e=>{e.addEventListener("click",function(t){t.preventDefault();const n=e.getAttribute("data-id"),o=e.getAttribute("data-title")||"YouTube Video",a=document.createElement("iframe");a.width="100%",a.height="100%",a.src=`https://www.youtube-nocookie.com/embed/${n}?autoplay=1&rel=0`,a.title=o,a.allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",a.allowFullscreen=!0,a.loading="lazy",e.innerHTML="",e.appendChild(a)})})}function initNewsletterForm(){const e=document.getElementById("newsletter-form");e&&e.addEventListener("submit",async function(t){t.preventDefault();if(!isValidEmail(new FormData(e).get("email")))return void showFormMessage("Please enter a valid email address.","error");const n=e.querySelector('button[type="submit"]'),o=n.textContent;n.disabled=!0,n.textContent="Sending...";try{await new Promise(e=>setTimeout(e,1e3)),showFormMessage("Thank you for subscribing!","success"),e.reset()}catch(e){showFormMessage("Sorry, an error occurred. Please try again.","error")}finally{n.disabled=!1,n.textContent=o}})}function showFormMessage(e,t){const n=document.getElementById("newsletter-form");if(!n)return;n.querySelectorAll(".form-message").forEach(e=>e.remove());const o=document.createElement("div");o.className=`form-message form-message--${t}`,o.textContent=e,o.style.padding="var(--spacing-md)",o.style.marginTop="var(--spacing-md)",o.style.borderRadius="var(--border-radius)",o.style.fontWeight="var(--font-weight-medium)","success"===t?(o.style.backgroundColor="var(--color-success)",o.style.color="white"):(o.style.backgroundColor="var(--color-error)",o.style.color="white"),n.appendChild(o),setTimeout(()=>{o.remove()},5e3)}function initScrollAnimations(){const e=new IntersectionObserver(function(t){t.forEach(t=>{t.isIntersecting&&(t.target.classList.add("fade-in"),e.unobserve(t.target))})},{threshold:.1,rootMargin:"0px 0px -50px 0px"});document.querySelectorAll(".feature-card, .pricing-card, .use-case").forEach(t=>{e.observe(t)})}function checkLanguageSuggestion(){const e=document.getElementById("language-suggestion");if(!e||getStorageItem("language_dismissed"))return;const t=navigator.language||navigator.userLanguage,n=STATE.currentLanguage;if(t.startsWith("fr")&&"fr"!==n||!t.startsWith("fr")&&"fr"===n){e.hidden=!1;const t=document.getElementById("dismiss-language");t&&t.addEventListener("click",function(){e.hidden=!0,setStorageItem("language_dismissed",!0,30)})}}function isValidEmail(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}function setStorageItem(e,t,n){try{const o={value:t,expiry:n?Date.now()+24*n*60*60*1e3:null};localStorage.setItem(e,JSON.stringify(o))}catch(e){console.warn("Could not access localStorage:",e)}}function getStorageItem(e){try{const t=localStorage.getItem(e);if(!t)return null;const n=JSON.parse(t);return n.expiry&&Date.now()>n.expiry?(localStorage.removeItem(e),null):n.value}catch(e){return console.warn("Could not access localStorage:",e),null}}document.addEventListener("DOMContentLoaded",function(){console.log("DOM chargé - Initialisation de l'application"),initApplication()}),window.addEventListener("error",function(e){console.error("Global error:",e.error)}),window.addEventListener("unhandledrejection",function(e){console.error("Unhandled promise rejection:",e.reason),e.preventDefault()}),console.log("Main JS module chargé - Version corrigée");