# ==========================================================================
# Netlify config — Voiceover Captions AI (PROD)
# ==========================================================================

[build]
  publish = "."
  command = "echo 'Static site — no build step'"

[build.environment]
  NODE_VERSION = "18"

# ==========================================================================
# Security headers (safe defaults)
# ==========================================================================
[[headers]]
  for = "/*"
  [headers.values]
    X-Content-Type-Options = "nosniff"
    X-Frame-Options = "DENY"
    X-XSS-Protection = "1; mode=block"
    Referrer-Policy = "strict-origin-when-cross-origin"
    Permissions-Policy = "geolocation=(), microphone=(), camera=(), payment=()"
    Strict-Transport-Security = "max-age=31536000; includeSubDomains; preload"

# ==========================================================================
# Caching
#   - Assets: long cache + immutable (fingerprinting/ ?v=… recommandé)
#   - HTML: cache court et revalidation
# ==========================================================================
[[headers]]
  for = "/assets/*"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/images/*"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/videos/*"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/*.html"
  [headers.values]
    Cache-Control = "public, max-age=3600, must-revalidate"

# ==========================================================================
# Content types utiles
# ==========================================================================
[[headers]]
  for = "/sitemap.xml"
  [headers.values]
    Content-Type = "application/xml"

[[headers]]
  for = "/sitemaps/*"
  [headers.values]
    Content-Type = "application/xml"

[[headers]]
  for = "/robots.txt"
  [headers.values]
    Content-Type = "text/plain"

# ==========================================================================
# i18n — EN par défaut, FR si navigateur FR
# (laisse la navigation explicite entre / et /fr/)
# ==========================================================================
[[redirects]]
  from = "/"
  to = "/index.html"
  status = 200
  conditions = { Language = ["en", "en-US", "en-GB", "en-*"] }

[[redirects]]
  from = "/"
  to = "/fr/index.html"
  status = 200
  conditions = { Language = ["fr", "fr-FR", "fr-*"] }

# ==========================================================================
# Domaine canonique (quand tu pointeras le domaine)
# ==========================================================================
[[redirects]]
  from = "http://voiceover-captions-ai.com/*"
  to = "https://voiceover-captions-ai.com/:splat"
  status = 301
  force = true

[[redirects]]
  from = "http://www.voiceover-captions-ai.com/*"
  to = "https://voiceover-captions-ai.com/:splat"
  status = 301
  force = true

[[redirects]]
  from = "https://www.voiceover-captions-ai.com/*"
  to = "https://voiceover-captions-ai.com/:splat"
  status = 301
  force = true

# Align extensionless URLs to canonical .html (hreflang self-reference)
[[redirects]]
  from = "/legal-notice.html"
  to = "/legal-notice"
  status = 301
  force = true

[[redirects]]
  from = "/privacy-policy.html"
  to = "/privacy-policy"
  status = 301
  force = true

[[redirects]]
  from = "/fr/mentions-legales.html"
  to = "/fr/mentions-legales"
  status = 301
  force = true

[[redirects]]
  from = "/fr/politique-de-confidentialite.html"
  to = "/fr/politique-de-confidentialite"
  status = 301
  force = true

# ==========================================================================
# Processing (minify)
# ==========================================================================
[[processing]]
  for = "*.js"
  [processing.options]
    minify_js = true

[[processing]]
  for = "*.css"
  [processing.options]
    minify_css = true

[[processing]]
  for = "*.html"
  [processing.options]
    minify_html = true

# Contexts
[context.production.environment]
  NODE_ENV = "production"

[context.deploy-preview.environment]
  NODE_ENV = "development"

[context.branch-deploy.environment]
  NODE_ENV = "development"
